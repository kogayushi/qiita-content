---
title: Spring MVCã®RestControllerã®RequestParamã§ä»»æ„ã®Enumã‚’ã‚³ãƒ¼ãƒ‰ãªã©ã®åˆ¥ã®å€¤ã§å—ã‘å–ã‚‹æ–¹æ³•
tags:
  - spring-mvc
private: false
updated_at: '2019-11-29T08:56:05+09:00'
id: ff3338c34ce59c20bd5f
organization_url_name: null
slide: false
ignorePublish: false
---
## ã¯ã˜ã‚ã«
Enumã‚’RESTful APIãªã©ã§ä»–ã‚¢ãƒ—ãƒªã¨é€£æºã™ã‚‹å ´åˆã€Enumã®åå‰ã‚’å¤‰æ›´ã™ã‚‹å¯èƒ½æ€§ã‚’è€ƒæ…®ã™ã‚‹ã¨ã‚³ãƒ¼ãƒ‰ã§é€£æºã—ãŸã„ã¨æ€ã†ã¨ããŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ãã®å ´åˆã€Spring MVCã‚’ä½¿ã£ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚³ãƒ¼ãƒ‰ã§å—ã‘å–ã‚Šã¤ã¤ã‚‚ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å¼•æ•°ã§å—ã‘å–ã£ãŸã¨ãã«ã¯Enumã«å¤‰æ›ã—çµ‚ã‚ã£ã¦ã¦ã»ã—ã„ã¨æ€ã†ã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ã®è¨˜äº‹ã¯ãã‚Œã‚’å®Ÿç¾ã™ã‚‹ä¸€ã¤ã®æ–¹æ³•ã®ã”ç´¹ä»‹ã§ã™ã€‚

## é”æˆã—ãŸã„ã“ã¨
- `@RestController`ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§`@RequestParam`ã§Enumã‚’å—ã‘å–ã‚Šã¨ã‚Šã€ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

## æƒ³å®šã—ã¦ã„ã‚‹ã“ã¨
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã®ã‚„ã‚Šå–ã‚Šã‚’ã‚³ãƒ¼ãƒ‰å€¤ã§ã—ã¦ã„ã‚‹å ´åˆãªã©ã‚’æƒ³å®šã€‚

## äº‹å‰èª¿æŸ»ãƒ»ãƒ’ãƒ³ãƒˆ
- [StringToEnumConverterFactory. StringToEnumConverterFactory](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/convert/support/StringToEnumConverterFactory.java#L38)ã®å®Ÿè£…ã‚’çœŸä¼¼ã™ã‚Œã°ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰çµŒç”±ã§ã‚„ã‚ŠãŸã„ã“ã¨ã¯å®Ÿç¾ã§ãã‚‹ã€‚
  - ãŸã ã€å˜ç´”ã«çœŸä¼¼ã™ã‚‹ã¨Enumã®æ•°ã ã‘Factoryã¾ãŸã¯Converterã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã«ãªã‚‹
  - ä½•åº¦ã‚‚æ›¸ããŸããªã„ã®ã§å‡¦ç†ã‚’å…±é€šåŒ–ã—ã¦ãŠããŸã„ã€‚

## ã„ããªã‚Šçµè«–ã€œå®Ÿç¾ã—ãŸæ–¹æ³•ã€œ
1. ã‚³ãƒ¼ãƒ‰å€¤ã‚’ç”¨ã„ã‚‹Enumç”¨ã®interfaceã‚’ç”¨æ„ã™ã‚‹
2. ã‚³ãƒ¼ãƒ‰å€¤ã‚’ç”¨ã„ã‚‹Enumã§(1)ã‚’å®Ÿè£…ã™ã‚‹
3. ãã®Enumã«å¯¾ã—ã¦StringToEnumã‚’å‚è€ƒã«ã—ãŸConverterã¨Factoryã‚’å®Ÿè£…ã™ã‚‹
4. RestControllerã«Enumã‚’ä½¿ã†

## ä½•ã¯ã¨ã‚‚ã‚ã‚Œã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨è§£èª¬
- [Javaç‰ˆ](https://github.com/kogayushi/spring-mvc-requestparam-enum-java)
- [Kotlinç‰ˆ](https://github.com/kogayushi/spring-mvc-requestparam-enum-kotlin)

### ã‚³ãƒ¼ãƒ‰è§£èª¬
ã‚³ãƒ¼ãƒ‰å†…ã§ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹å½¢ã§è§£èª¬ã—ã¦ã„ãã¾ã™
#### Javaç‰ˆå®Ÿè£…
##### 1. ã‚³ãƒ¼ãƒ‰å€¤ã‚’ç”¨ã„ã‚‹Enumç”¨ã®interfaceã‚’ç”¨æ„ã™ã‚‹
```java
import java.util.Arrays;

public interface EnumBase<E extends Enum<E>> { // 1. Genericsã§Enumã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€Enumã«ã—ã‹ç¶™æ‰¿ã•ã›ãªã„ã‚ˆã†ã«ã™ã‚‹
                                               // åŒåƒšã«æ•™ãˆã¦ã‚‚ã‚‰ã£ãŸãŒã€å†èµ·çš„ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã¨ã„ã†åå‰ãŒã¤ã„ã¦ã„ã‚‹ã‚‰ã—ã„ã§ã™ã€‚
                                               // ã‚ˆãã‚ã‹ã£ã¦ãªã„ã®ã§é–“é•ã£ã¦ã„ã‚Œã°æŒ‡æ‘˜ãŠé¡˜ã„ã—ã¾ã™ğŸ™‡â€â™‚ï¸

    // 2. ã‚³ãƒ¼ãƒ‰å€¤ã‚’ä½¿ã†ã®ã§ã€ãã®getterã‚’ç”Ÿã‚„ã—ã¦ãŠã
    String getCode();

    // 3. `<E extends EnumBase> E`ã®Genericsã§input/outputã®æ–¹ãŒåŒã˜ã ã¨å®£è¨€ã™ã‚‹
    public static <E extends EnumBase> E of(Class<E> enumClass, String code) {
        return Arrays.stream(enumClass.getEnumConstants()) // 4. (3)ã«ã‚ˆã£ã¦`enumClass`ã¯Enumã§ã‚ã‚‹ã¨ä»®å®šã§ãã‚‹ã¯ãšãªã®ã§ã€`getEnumConstants()`ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’ã™ã¹ã¦å–å¾—ã—ã¦streamã«å¤‰æ›
                     .filter(it -> it.getCode().equals(code)) // 6. å¼•æ•°ã®`code`ã¨ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’æ¤œç´¢
                     .findFirst() // 7. 1ä»¶ã®ã¿è©²å½“ã™ã‚‹ã¯ãšãªã®ã§æœ€åˆã«ä¸€è‡´ã—ãŸã‚‚ã®ã‚’é¸æŠ
                     // 8. è©²å½“ã™ã‚‹ã‚‚ã®ãŒãªã‹ã£ãŸå ´åˆã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒã‚°ãªã®ã§Exceptionã‚’é£›ã°ã—ã¦FWã¾ã§è²«é€šã•ã›ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹
                     // ã‚‚ã—ã€ã“ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ã¯å•é¡ŒãŒã‚ã‚‹å ´åˆã¯`null`ã‚’è¿”ã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã›ã‚‹
                     .orElseThrow(() -> new IllegalArgumentException(String.format("%s does not have such code => [%s]",
                                                                                   enumClass.getSimpleName(),
                                                                                   code)));
    }
}
```

##### 2. ã‚³ãƒ¼ãƒ‰å€¤ã‚’ç”¨ã„ã‚‹Enumã§(1)ã‚’å®Ÿè£…ã™ã‚‹
```java
public enum JvmLanguage implements EnumBase<JvmLanguage> { // 1. Genericsã«è‡ªåˆ†è‡ªèº«ã‚’æŒ‡å®šã—ã¦Enumã§ã‚ã‚‹ã“ã¨ã‚’EnumBaseã«æ•™ãˆã‚‹
    JAVA("10", "Java"), // 2. ã‚³ãƒ¼ãƒ‰å€¤ã¨ã¨ã‚‚ã«Enumã‚’å®£è¨€ã™ã‚‹
    KOTLIN("20", "Kotlin"),
    SCALA("30", "Scala"),
    GROOVY("40", "Groovy");
    // Jvmè¨€èªã¯ä»–ã«ã‚‚ã‚ã‚‹ãŒã€ã‚ˆãè¦‹èãã™ã‚‹ã‚‚ã®ã ã‘ã‚’å–ã‚Šä¸Šã’ã¦ã„ã‚‹ã€‚ã“ã“ã§ãƒã‚µã‚«ãƒªã¯æ¬²ã—ããªã„â€¦ã€‚

    private String code;
    private String genericName;

    @Override
    public String getCode() {
        return this.code;
    }

    public String getGenericName() {
        return this.genericName;
    }

    JvmLanguage(String code, String genericName) {
        this.code = code;
        this.genericName = genericName;
    }
}
```

##### 3. ãã®Enumã«å¯¾ã—ã¦StringToEnumã‚’å‚è€ƒã«ã—ãŸConverterã¨Factoryã‚’å®Ÿè£…ã™ã‚‹
```java
import org.springframework.core.convert.converter.Converter;
import org.springframework.core.convert.converter.ConverterFactory;

class CustomStringToEnumConverterFactory implements ConverterFactory<String, EnumBase> {
    @Override // 1. `StringToEnumConverterFactory`ã§ã¯`<T extends Enum>`ã¨ãªã£ã¦ã„ã‚‹ãŒã€`EnumBase`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’Genericsã«æŒ‡å®šã™ã‚‹
    public <T extends EnumBase> Converter<String, T> getConverter(Class<T> targetType) {
        return new CustomStringToEnumConverter(targetType);
    }

    // 2. `StringToEnumConverter`ã§ã¯`<T extends Enum>`ã¨ãªã£ã¦ã„ã‚‹ãŒã€ã“ã“ã‚‚`EnumBase`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’Genericsã«æŒ‡å®šã™ã‚‹
    private static class CustomStringToEnumConverter<T extends EnumBase> implements Converter<String, T> {
        private Class<T> enumType;

        CustomStringToEnumConverter(Class<T> enumType) {
            this.enumType = enumType;
        }

        @Override
        public T convert(String source) {
            if (source.isEmpty()) {
                return null;
            }
            return EnumBase.of(enumType, source.trim());
        }
    }
}
```

å‘¼ã³å‡ºã—ã¦ã„ã‚‹Springå´ã®ã‚³ãƒ¼ãƒ‰ã‚‚èª­ã‚“ã§GenericsãŒã©ã†ä½œç”¨ã—ã¦ã„ã‚‹ã®ã‹ã‚‚ã£ã¨è©³ç´°ãªè§£èª¬ã‚’ã—ã‚ˆã†ã‹ã¨æ€ã£ãŸã®ã§ã™ãŒã€æ­£ç›´èª­ã¿è§£ãã®ãŒå¤§å¤‰ãã†ã§æ–­å¿µã—ã¦ã—ã¾ã„ã¾ã—ãŸorz

ä¸å‹‰å¼·ã§ç”³ã—è¨³ãªã„ã§ã™

èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã”è‡ªèº«ã§[GenericConversionService](https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/convert/support/GenericConversionService.java)ã‚’èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

##### 4. RestControllerã«Enumã‚’ä½¿ã†
```java
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

@RequestMapping("/jvm-languages")
@RestController
public class JvmLanguageResource {

    @GetMapping
    public List<String> list() {
        return Arrays.stream(JvmLanguage.values())
                     .map(JvmLanguage::getGenericName)
                     .collect(Collectors.toList());
    }

    @GetMapping("/genericName") // 1. `@RequestParam`ã«`EnumBase`ã‚’ç¶™æ‰¿ã—ãŸEnumã‚’æŒ‡å®šã™ã‚‹
    public String answer(@RequestParam(name = "code") JvmLanguage jvmLanguage) {
        return jvmLanguage.getGenericName();
    }
}
```

#### Kotlinç‰ˆå®Ÿè£…
Javaã¨é•ã„ã¯ãªã„ã®ã§è§£èª¬ã¯ã—ã¾ã›ã‚“ã€‚
ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ã¦ã„ãã¾ã™ã€‚

##### 1. ã‚³ãƒ¼ãƒ‰å€¤ã‚’ç”¨ã„ã‚‹Enumç”¨ã®interfaceã‚’ç”¨æ„ã™ã‚‹
```kotlin
interface EnumBase<E : Enum<E>> {
    val code: String

    companion object {
        fun <E : EnumBase<*>> of(enumClass: Class<E>, code: String): E {
            return enumClass.enumConstants
                .firstOrNull { it.code == code }
                ?: throw IllegalArgumentException(String.format("%s does not have such code => [%s]", enumClass.simpleName, code))
        }
    }
}
```

##### 2. ã‚³ãƒ¼ãƒ‰å€¤ã‚’ç”¨ã„ã‚‹Enumã§(1)ã‚’å®Ÿè£…ã™ã‚‹
```kotlin
enum class JvmLanguage(override val code: String, val genericName: String) : EnumBase<JvmLanguage> {
    JAVA("10", "Java"),
    KOTLIN("20", "Kotlin"),
    SCALA("30", "Scala"),
    GROOVY("40", "Groovy");
}
```

##### 3. ãã®Enumã«å¯¾ã—ã¦StringToEnumã‚’å‚è€ƒã«ã—ãŸConverterã¨Factoryã‚’å®Ÿè£…ã™ã‚‹
```kotlin
import org.springframework.core.convert.converter.Converter
import org.springframework.core.convert.converter.ConverterFactory

class CustomStringToEnumConverterFactory : ConverterFactory<String, EnumBase<*>> {
    override fun <T : EnumBase<*>> getConverter(targetType: Class<T>): Converter<String, T> {
        return CustomStringToEnumConverter(targetType)
    }

    private class CustomStringToEnumConverter<T : EnumBase<*>>(private val enumType: Class<T>) : Converter<String, T> {
        override fun convert(source: String): T? {
            return if (source.isEmpty()) {
                null
            } else EnumBase.of(enumType, source.trim { it <= ' ' })
        }
    }
}
```

##### 4. RestControllerã«Enumã‚’ä½¿ã†
```kotlin
import org.springframework.web.bind.annotation.GetMapping
import org.springframework.web.bind.annotation.RequestMapping
import org.springframework.web.bind.annotation.RequestParam
import org.springframework.web.bind.annotation.RestController

@RequestMapping("/jvm-languages")
@RestController
class JvmLanguageResource {
    @GetMapping
    fun list(): List<String> {
        return JvmLanguage.values().map { it.genericName }
    }

    @GetMapping("/genericName")
    fun answer(@RequestParam(name = "code") jvmLanguage: JvmLanguage): String? {
        return jvmLanguage.genericName
    }
}
```

##### ãƒ‡ãƒ¢
ã“ã‚Œã§ã€ã©ã¡ã‚‰ã®å®Ÿè£…ã§ã‚‚ã‚³ãƒ¼ãƒ‰å€¤ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦Enumã§å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
å®Ÿéš›ã«curlã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```shell
$ echo `curl -sS http://localhost:8080/jvm-languages/genericName?code=10`
Java
```

## å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸè¨˜äº‹
- ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸğŸ™‡â€â™‚ï¸
- [Enumã®é€†å¼•ããŒå†—é•·ãªã®ã§å…±é€šåŒ–ã™ã‚‹](https://qiita.com/dkurata38/items/830bbeb8208f5ee29cf2)
    - interface(EnumBase)ã«ç”Ÿã‚„ã™staticãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‹ã‚‰ç€æƒ³ã‚’å¾—ã¾ã—ãŸã€‚ã¨ã†ã‹ã‚³ãƒ”ãƒšã•ã›ã¦é ‚ãã¾ã—ãŸğŸ™‡â€â™‚ï¸
